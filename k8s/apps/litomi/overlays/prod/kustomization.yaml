apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: litomi

resources:
  - ../../base
  - ingress.yaml

generatorOptions:
  disableNameSuffixHash: true

configMapGenerator:
  # Frontend에서 쓰는 public env
  - name: litomi-public-env
    literals:
      - NEXT_PUBLIC_CANONICAL_URL=https://local.litomi.in
      - NEXT_PUBLIC_BACKEND_URL=https://api-local.litomi.in
      # Vercel edge proxy (managed outside k3s/Argo CD)
      - NEXT_PUBLIC_EXTERNAL_API_PROXY_URL=https://vercel.litomi.in
      - NEXT_PUBLIC_CORS_PROXY_URL=
      - NEXT_PUBLIC_TURNSTILE_SITE_KEY=1x00000000000000000000AA
      - NEXT_PUBLIC_VAPID_PUBLIC_KEY=123

  # Backend(Hono) runtime env
  - name: litomi-backend-env
    literals:
      - CORS_ORIGIN=https://local.litomi.in

      # DB (single local Postgres in cluster)
      - POSTGRES_URL=postgresql://litomi:test_password@postgres:5432/litomi
      - POSTGRES_URL_DIRECT=postgresql://litomi:test_password@postgres:5432/litomi
      - POSTGRES_URL_NON_POOLING=postgresql://litomi:test_password@postgres:5432/litomi
      - AIVEN_POSTGRES_URL=postgresql://litomi:test_password@postgres:5432/litomi

      # Upstash REST compatible (serverless-redis-http)
      - UPSTASH_KV_REST_API_URL=http://srh:80
      - UPSTASH_KV_REST_API_TOKEN=local_dev_token
      - UPSTASH_REDIS_REST_URL=http://srh:80
      - UPSTASH_REDIS_REST_TOKEN=local_dev_token

images:
  - name: litomi-web
    newTag: local
  - name: litomi-backend
    newTag: local

