apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  # Pinned release manifest.
  - https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.7.2/components.yaml

patches:
  # k3s/온프레미스에서 kubelet 인증서/주소 문제로 metrics가 안 뜨는 경우가 많아서 기본 플래그를 추가해요.
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: metrics-server
      namespace: kube-system
    patch: |-
      - op: add
        path: /spec/template/spec/containers/0/args/-
        value: --kubelet-insecure-tls
      - op: add
        path: /spec/template/spec/containers/0/args/-
        value: --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname

