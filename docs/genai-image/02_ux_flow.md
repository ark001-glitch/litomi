## UX/플로우: 브라우저(WebGPU) 온디바이스 이미지 생성

### 1) IA(정보구조)

- **이미지 생성 홈**
  - 모델 선택/관리(설치, 삭제) (Import는 후순위)
  - 프롬프트 입력/옵션
  - 생성 결과 갤러리(로컬 세션 내)

### 2) 핵심 화면 흐름

#### Flow A: 최초 진입(환경 체크)

1. 진입 시 **WebGPU 지원 확인**
2. 미지원이면 “지원 브라우저/환경 안내” 화면 노출
3. 지원이면 “짧은 워밍업/미니 벤치” 실행
4. 벤치 결과로 기본 프리셋 선택(예: 1024/768, steps 기본값)

#### Flow B: 모델 설치(온라인 다운로드)

1. 사용자가 “모델 다운로드” 클릭
2. 모델 상세(스타일/용량/권장 설정/라이선스 링크) 확인
3. 다운로드 진행률(%) + 예상 잔여(선택) 표시
4. 완료 시 “설치됨” 상태로 전환
5. 바로 생성 화면으로 이동 또는 “이 모델로 시작” CTA 제공

#### Flow C: 모델 설치(로컬 Import) — 후순위

1. 다운로드가 실패하거나 사용자가 직접 파일을 갖고 있으면 “모델 파일 불러오기(Import)” 클릭
2. 파일 선택(권장: `.zip` 번들) → 검증(manifest/해시)
3. 검증 실패 시 오류 이유 노출(파일 누락/해시 불일치/호환되지 않는 런타임)
4. 성공 시 OPFS 저장 후 “설치됨”

#### Flow D: 이미지 생성(프리뷰 포함)

1. 모델이 “설치됨” 상태면 “불러오기(Load)” 가능
2. 모델 로드 중 스피너 + 단계 메시지(예: “모델 로딩 중…(최초 1회 오래 걸릴 수 있음)”)
3. 프롬프트 입력 후 “생성” 클릭
4. 생성 중:
   - 진행률(현재 step/전체 step)
   - 중간 프리뷰(예: 5/10/20 step 등)
   - 취소 버튼
5. 완료 시 결과 표시 + “로컬 저장(PNG)” + “다시 생성(같은 설정/새 시드)”
   - (옵션) “생성 결과 자동 저장(OPFS)”가 켜져 있으면 결과를 OPFS에도 저장

#### Flow E: 모델 전환

1. 다른 모델 선택 → 현재 로드된 모델 세션 dispose
2. 새 모델 로드
3. 이전 설정(steps/CFG/해상도)은 모델별로 기억(선택)

### 3) 상태(State) 정의

#### 3.1 환경 상태

- `UNSUPPORTED`: `navigator.gpu` 없음 또는 `requestAdapter()` 실패
- `SUPPORTED`: WebGPU 사용 가능
- `BENCHING`: 미니 벤치 실행 중
- `READY`: 사용 가능(프리셋 확정)

#### 3.2 모델 상태(모델별)

- `NOT_INSTALLED`
- `DOWNLOADING`(progress 0–100)
- `VERIFYING`
- `INSTALLED`
- `LOAD_PENDING`
- `LOADING`
- `LOADED`
- `ERROR`(errorCode, message)

#### 3.3 생성 상태(세션)

- `IDLE`
- `RUNNING`(step, totalSteps, previewImage?)
- `CANCELLED`
- `SUCCEEDED`(image)
- `FAILED`(reason)

### 4) 오류/예외 UX(필수)

#### WebGPU 미지원

- 메시지(예시):
  - “이 기능은 WebGPU를 지원하는 Chrome/Edge에서만 사용할 수 있어요.”
  - “브라우저를 최신 버전으로 업데이트하고 다시 시도해 주세요.”

#### 저장공간/영속 저장 실패

- `navigator.storage.persist()` 실패 또는 Quota 부족 시:
  - “브라우저가 저장공간을 확보하지 못했어요. 모델을 다시 다운로드해야 할 수 있어요.”
  - 설치된 모델 관리(삭제) CTA 제공

#### 다운로드 실패

- 네트워크 오류/404/CORS 등:
  - “다운로드에 실패했어요. 다시 시도해 주세요.”

#### 추론 실패(WebGPU device lost / OOM)

- 복구 옵션:
  - “해상도를 768로 낮추기”
  - “steps 줄이기”
  - “다시 시도”

### 5) 기본 UI 컨트롤(권장)

- 모델 선택 드롭다운/카드 리스트
- **버튼**
  - “모델 다운로드”
  - (후순위) “모델 파일 불러오기(Import)”
- 고급 설정(접기):
  - 해상도(자동/1024/768)
  - steps
  - CFG
  - seed(고정/랜덤)
  - (옵션) 생성 결과 자동 저장(OPFS)
